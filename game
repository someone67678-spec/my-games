<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>A Small World Cup</title>
<style>
    body {
        margin: 0;
        background: #0b6623;
        touch-action: none;
        user-select: none;
    }
    canvas {
        display: block;
        margin: auto;
        background: #1e8f4d;
    }
</style>
</head>
<body>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize", resize);

const friction = 0.98;
const players = [];
let currentPlayer = 0;
let ball;

class Circle {
    constructor(x, y, r, color) {
        this.x = x;
        this.y = y;
        this.r = r;
        this.vx = 0;
        this.vy = 0;
        this.color = color;
    }

    draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.r, 0, Math.PI * 2);
        ctx.fillStyle = this.color;
        ctx.fill();
    }

    update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vx *= friction;
        this.vy *= friction;

        if (Math.abs(this.vx) < 0.05) this.vx = 0;
        if (Math.abs(this.vy) < 0.05) this.vy = 0;

        // walls
        if (this.x < this.r || this.x > canvas.width - this.r) this.vx *= -1;
        if (this.y < this.r || this.y > canvas.height - this.r) this.vy *= -1;
    }
}

function init() {
    players.length = 0;
    players.push(
        new Circle(100, canvas.height / 2, 25, "blue"),
        new Circle(canvas.width - 100, canvas.height / 2, 25, "red")
    );
    ball = new Circle(canvas.width / 2, canvas.height / 2, 15, "white");
}
init();

let startX, startY, aiming = false;

canvas.addEventListener("touchstart", e => {
    const t = e.touches[0];
    startX = t.clientX;
    startY = t.clientY;
    aiming = true;
});

canvas.addEventListener("touchend", e => {
    if (!aiming) return;
    aiming = false;

    const dx = startX - lastX;
    const dy = startY - lastY;

    players[currentPlayer].vx = dx * 0.15;
    players[currentPlayer].vy = dy * 0.15;

    currentPlayer = (currentPlayer + 1) % players.length;
});

let lastX, lastY;
canvas.addEventListener("touchmove", e => {
    const t = e.touches[0];
    lastX = t.clientX;
    lastY = t.clientY;
});

function collide(a, b) {
    const dx = b.x - a.x;
    const dy = b.y - a.y;
    const dist = Math.hypot(dx, dy);
    if (dist < a.r + b.r) {
        const angle = Math.atan2(dy, dx);
        const force = 1.5;
        a.vx -= Math.cos(angle) * force;
        a.vy -= Math.sin(angle) * force;
        b.vx += Math.cos(angle) * force;
        b.vy += Math.sin(angle) * force;
    }
}

function drawField() {
    ctx.fillStyle = "#1e8f4d";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.strokeStyle = "white";
    ctx.lineWidth = 4;
    ctx.strokeRect(20, 20, canvas.width - 40, canvas.height - 40);

    ctx.beginPath();
    ctx.arc(canvas.width / 2, canvas.height / 2, 60, 0, Math.PI * 2);
    ctx.stroke();
}

function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawField();

    players.forEach(p => p.update());
    ball.update();

    collide(players[0], ball);
    collide(players[1], ball);

    players.forEach(p => p.draw());
    ball.draw();

    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
